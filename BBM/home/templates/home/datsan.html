{%load static%}

<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title Page-->
    <title>Đăng Ký Đặt Sân Cầu Lông</title>
    <link rel="stylesheet" href="{% static 'home/css/datsan.css' %}">
</head>

<body>
    <div class="page-wrapper bg-gra-01 p-t-45 p-b-50">
        <div class="wrapper wrapper--w790">
            <div class="card card-5">
                <div class="card-heading">
                    <h2 class="title">Đăng Ký Đặt Sân Cầu Lông</h2>
                </div>
                <div class="card-body">
                    <form id="bookingForm" method="POST">

                        <!-- Chọn loại lịch -->
                        <div class="form-group">
                            <label for="bookingType">Chọn loại hình đặt sân</label>
                            <select id="bookingType" name="bookingType" required>
                                <option value="">--Chọn--</option>
                                <option value="fixed">Đặt lịch cố định</option>
                                <option value="daily">Đặt theo ngày</option>
                                <option value="flexible">Đặt lịch linh hoạt</option>
                            </select>
                        </div>

                        <!-- Đặt lịch cố định -->
                        <div id="fixedBooking" class="hidden">
                            <div class="form-group">
                                <label for="starDate">Ngày bắt đầu:</label>
                                <input type="date" id="starDate" name="starDate" required>
                                <p id="startDateDisplay"></p> <!-- Hiển thị thứ + ngày/tháng/năm -->
                                <br>

                                <label for="endDate">Ngày kết thúc:</label>
                                <input type="date" id="endDate" name="endDate" required>
                                <p id="endDateDisplay"></p> <!-- Hiển thị thứ + ngày/tháng/năm -->
                                <br>
                                <label for="San">Sân:</label>
                                <select id="fixedDay" name="fixedDay">
                                    {% for san in available_san %}
                                    <option value="{{ san.maSan }}">Sân {{ san.numSan }}</option>
                                    {% endfor %}
                                </select> 
                                <label for="time-slot">Time-slot:</label>
                                <div class = "select-container">
                                    <div class="select-gird">
                                        {% for timeslot in available_timeslots %}
                                        <option value="{{ timeslot.timeslot }}">{{ timeslot.timeslot }}</option>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                
                        <!-- Đặt lịch theo ngày -->
                        <form method="GET" action="{% url 'datsan' court.maCourt %}">
                            {% csrf_token %}
                            <div id="dailyBooking" class="hidden">
                                <div class="form-group">
                                    <label for="playDate">Ngày, tháng, năm:</label>
                                    <input type="date" id="playDate" name="playDate" required> 
                                    
                                    <label for="San">Sân:</label>
                                    <select id="san" name="san" onchange="this.form.submit()">
                                        <option value="">-- Chọn sân --</option>
                                        {% for san in available_san %}
                                            <option value="{{ san.maSan }}" {% if san.maSan == selected_san_id %}selected{% endif %}>
                                                Sân {{ san.numSan }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                    {% if selected_san_id %}
                                    <label for="time-slot">Time-slot:</label>
                                    <select id="time-slot" name="timeslot">
                                        {% for timeslot in available_timeslots %}
                                            <option value="{{ timeslot.timeslot }}">{{ timeslot.timeslot }}</option>
                                        {% empty %}
                                            <option value="">Không có time-slot khả dụng</option>
                                        {% endfor %}
                                    </select>
                                    {% endif %}
                                </div>
                            </div>
                        </form>
                    
                        <!-- Đặt lịch linh hoạt -->
                        <div id="flexibleBooking" class="hidden">
                            <div class="form-group">
                                <label for="flexibleBookingType">Đặt:</label>
                                <select id="flexibleBookingType" name="flexibleBookingType">
                                    <option value="">--Chọn--</option>
                                    <option value="hour">Đặt thêm giờ</option>
                                    <option value="calendar">Đặt lịch</option>
                                </select> 
                                
                                <div id="hourType" class="hidden">
                                    <label for="addHour">Thêm giờ:</label>
                                    <input type="number" id="addHour" name="addHour" required> 
                                </div>

                                <div id="calendarType" class="hidden">
                                    <label for="playDate">Ngày, tháng, năm:</label>
                                    <input type="date" id="playDate" name="playDate" required> 
                                    
                                    <label for="San">Sân:</label>
                                    <select id="fixedDay" name="fixedDay">
                                        {% for san in available_san %}
                                        <option value="{{ san.maSan }}">Sân {{ san.numSan }}</option>
                                        {% endfor %}
                                    </select> 

                                    <label for="time-slot">Time-slot:</label>
                                    <div class = "select-container">
                                        <div class="select-gird">
                                            {% for timeslot in available_timeslots %}
                                            <option value="{{ timeslot.timeslot }}">{{ timeslot.timeslot }}</option>
                                            {% endfor %}
                                        </div>
                                    </div>    
                                </div>
                            </div>
                        </div>
                        <!-- Kết thúc chọn loại lịch -->

                        <div class = "form-group">
                            <label value = "discountCode">Áp mã giảm giá</label>
                            <input type="text" id="discountCode" name="discountCode" required>
                            <p style="display: inline-block; margin-top: 10px;">Tổng thanh toán: <p>
                            <p style="display: inline-block; margin-top: 10px;">400.000đ</p>
                        </div>

                        <div>
                            <button class="btn btn--radius-2 btn--gradient" type="submit">Đặt sân</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('bookingType').addEventListener('change', function() {
            document.getElementById('fixedBooking').classList.add('hidden');
            document.getElementById('dailyBooking').classList.add('hidden');
            document.getElementById('flexibleBooking').classList.add('hidden');
    
            if (this.value === 'fixed') {
                document.getElementById('fixedBooking').classList.remove('hidden');
            } else if (this.value === 'daily') {
                document.getElementById('dailyBooking').classList.remove('hidden');
            } else if (this.value === 'flexible') {
                document.getElementById('flexibleBooking').classList.remove('hidden');
            }
        });

        document.getElementById('flexibleBookingType').addEventListener('change', function() {
            document.getElementById('hourType').classList.add('hidden');
            document.getElementById('calendarType').classList.add('hidden');

            if (this.value === 'hour') {
                document.getElementById('hourType').classList.remove('hidden');
            } else if (this.value === 'calendar') {
                document.getElementById('calendarType').classList.remove('hidden'); // SỬA ĐÚNG ID
            }
        });
    
        document.querySelectorAll('.select-slot').forEach(slot => {
            slot.addEventListener('click', () => {
                slot.classList.toggle('selected');
            });
        });

        function formatDateString(dateString) {
            const daysOfWeek = ["Chủ Nhật", "Thứ Hai", "Thứ Ba", "Thứ Tư", "Thứ Năm", "Thứ Sáu", "Thứ Bảy"];
            const date = new Date(dateString);
            if (isNaN(date)) return ""; // Kiểm tra nếu giá trị không hợp lệ

            const dayOfWeek = daysOfWeek[date.getDay()];
            const day = date.getDate();
            const month = date.getMonth() + 1; // Tháng bắt đầu từ 0 nên +1
            const year = date.getFullYear();

            return `${dayOfWeek}, ${day}/${month}/${year}`;
        }

        // Hiển thị thứ khi chọn ngày bắt đầu và kết thúc
        document.getElementById("starDate").addEventListener("change", function() {
            document.getElementById("startDateDisplay").innerText = formatDateString(this.value);
        });

        document.getElementById("endDate").addEventListener("change", function() {
            document.getElementById("endDateDisplay").innerText = formatDateString(this.value);
        });

        // Xử lý thay đổi Time Slot khi chọn Thứ
        document.getElementById("fixedDay").addEventListener("change", function() {
            const selectedDay = this.value; // Lấy giá trị của ngày đã chọn
            const timeSlotSelect = document.getElementById("timeSlot");
            
            // Xóa các option cũ
            timeSlotSelect.innerHTML = "";

            // Nếu có Time Slot cho ngày đã chọn
            if (timeSlots[selectedDay]) {
                timeSlots[selectedDay].forEach(slot => {
                    const option = document.createElement("option");
                    option.value = slot;
                    option.textContent = slot;
                    timeSlotSelect.appendChild(option);
                });
            } else {
                const option = document.createElement("option");
                option.value = "";
                option.textContent = "Không có Time Slot";
                timeSlotSelect.appendChild(option);
            }
        });

    </script>

</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->